<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vantage AI</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        :root { --bg: #f3f9ff; --sidebar: #e1effe; --t: #2c3e50; --b: #d0e3f7; --ai-msg: #ffffff; --user-msg: #2563eb; --accent: #2563eb; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg); display: flex; height: 100vh; overflow: hidden; }
        
        /* Sidebar & Overlay Logic */
        .sidebar { width: 280px; background: var(--sidebar); border-right: 1px solid var(--b); display: flex; flex-direction: column; padding: 20px; transition: 0.3s; z-index: 2000; }
        @media (max-width: 768px) { .sidebar { position: fixed; left: -280px; height: 100%; top: 0; } .sidebar.active { left: 0; } }
        #overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.2); z-index: 1500; }
        #overlay.active { display: block; }

        .main { flex: 1; display: flex; flex-direction: column; position: relative; }
        header { padding: 12px 20px; background: #fff; border-bottom: 1px solid var(--b); display: flex; align-items: center; gap: 15px; }
        #chat-flow { flex: 1; overflow-y: auto; padding: 20px 5% 120px; }
        
        /* Message Bubbles */
        .bubble { margin-bottom: 15px; padding: 12px 18px; border-radius: 20px; max-width: 80%; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .user-text { background: var(--user-msg); color: white; margin-left: auto; border-bottom-right-radius: 4px; }
        .ai-text { background: var(--ai-msg); margin-right: auto; border-bottom-left-radius: 4px; border: 1px solid var(--b); }

        /* Premium Input Area */
        .input-area { position: fixed; bottom: 0; width: 100%; padding: 20px 0; background: linear-gradient(transparent, var(--bg) 40%); }
        .wrapper { margin: 0 5%; background: #fff; border-radius: 35px; display: flex; padding: 5px 8px 5px 18px; align-items: center; border: 1px solid var(--b); box-shadow: 0 5px 15px rgba(0,0,0,0.08); }
        input { flex: 1; border: none; outline: none; height: 45px; font-size: 16px; background: transparent; }
        
        /* Premium Send Button */
        .send-btn { 
            background: var(--accent); color: white; border: none; width: 42px; height: 42px; 
            border-radius: 50%; display: flex; align-items: center; justify-content: center; 
            cursor: pointer; font-size: 18px; transition: 0.3s; box-shadow: 0 4px 10px rgba(37, 99, 235, 0.3);
        }
        .send-btn:active { transform: scale(0.9); }
        .btn-mic { background: none; border: none; font-size: 24px; cursor: pointer; color: #64748b; margin-right: 10px; }
    </style>
</head>
<body>

<div id="overlay" onclick="toggleMenu()"></div>
<div class="sidebar" id="sidebar">
    <h3 style="margin-top:0;">Vantage Core</h3>
    <button onclick="location.reload()" style="padding:10px; border:none; border-radius:10px; cursor:pointer; background:#fff; width:100%;">Ôºã New Chat</button>
</div>

<div class="main">
    <header><button class="btn-mic" onclick="toggleMenu()">‚ò∞</button> <b>Vantage AI ‚ú®</b></header>
    <div id="chat-flow"></div>
    <div class="input-area">
        <div class="wrapper">
            <button class="btn-mic" onclick="startVoice()">üéôÔ∏è</button>
            <input type="text" id="query" placeholder="Type or Speak..." onkeypress="if(event.key==='Enter') execute()">
            <button class="send-btn" onclick="execute()">üöÄ</button>
        </div>
    </div>
</div>

<script>
    let chatContext = [];
    function toggleMenu() {
        document.getElementById('sidebar').classList.toggle('active');
        document.getElementById('overlay').classList.toggle('active');
    }
    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.onresult = (e) => { document.getElementById('query').value = e.results[0][0].transcript; execute(); };
    function startVoice() { recognition.start(); }
    function speak(t) { window.speechSynthesis.speak(new SpeechSynthesisUtterance(t.replace(/!\[.*?\]\(.*?\)/g, ""))); }

    async function execute() {
        const i = document.getElementById("query");
        const val = i.value.trim();
        if(!val) return;
        addMsg(val, true);
        chatContext.push({role: "user", content: val});
        i.value = "";
        try {
            const res = await fetch("/api/chat", { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ messages: chatContext }) });
            const data = await res.json();
            const aiReply = data.choices[0].message.content;
            addMsg(aiReply, false);
            chatContext.push({role: "assistant", content: aiReply});
            speak(aiReply);
        } catch (e) { addMsg("Error ‚ö†Ô∏è", false); }
    }
    function addMsg(t, u) {
        const flow = document.getElementById("chat-flow");
        flow.innerHTML += `<div class="bubble ${u ? 'user-text' : 'ai-text'}">${marked.parse(t)}</div>`;
        flow.scrollTop = flow.scrollHeight;
    }
</script>
</body>
</html>
